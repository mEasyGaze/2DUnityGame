#### **新手教程系統模組 (Tutorial System Module)**

1. `TutorialSO.cs`(ScriptableObject)：
    (1) 數據容器：包含唯一的 tutorialID 和一個 TutorialStep 列表。

2. `TutorialStep.cs`(資料)：
    (1) 定義單一步驟的所有細節。
    (2) 顯示內容、佈局、高亮目標和流程控制模式。

3. `TutorialDatabase.cs`：
    (1) 從 Resources 文件夾加載所有 TutorialSO 並存儲在字典中，供 TutorialManager 查詢。

4. `TutorialTargetID.cs`：
    (1) 一個空的 ScriptableObject 作為引用。

5. `TutorialTarget.cs`：
    (1) 引用 TutorialTargetID，供 TutorialUI 查找。

6. `TutorialManager.cs`：
    (1) 完成狀態追蹤：系統需要記錄哪些教學已經顯示過，避免重複觸發。這個狀態需要被存檔。
    (2) 觸發邏輯：當被調用時，它首先會檢查該 tutorialID 是否已存在於 completedTutorials 中。

7. `TutorialTrigger.cs`：
    (1) 可以是一個放置在場景中的 Collider（玩家進入時觸發），也可以是一個可以被其他系統（如對話系統的 DialogueAction）調用的方法。

8. `TutorialUI.cs`：
    (1) 數據渲染：根據傳入的 tutorialID 透過 `TutorialStep` 數據來更新文本和圖片。
    (2) 簡單交互：一個關閉按鈕，允許玩家在閱讀完畢後關閉教學窗口。
    (3) 進程控制：
    *   UI面板上新增一個可選的「繼續」按鈕，根據 `TutorialStep` 的 `進程觸發器` 來決定是否顯示。
    *   新增一個覆蓋全屏的、透明的 `Image` 或 `Button`，用於捕捉 `ClickAnywhere` 的點擊。
    (4) 自我註冊：在 Awake 時向 TutorialManager 註冊自己，建立通信。

9. `TutorialLayoutView.cs`：
    (1) 接收 TutorialStep 數據並將其填充到對應的UI元件中。

10. `TutorialDashboardEditor.cs`：
    (1) 顯示所有 TutorialTargetID，並提供雙向引用查找和全局驗證功能。

11. `TutorialEventListener.cs`：
    (1) 監聽 ID 觸發 Highlight。

12. `HighlightableObjec.cs`：
  
13. `HighlightSystem.cs`：
    (1) 一個獨立的UI物件，作為「**箭頭圓圈提示 (Highlighter)**」。
    (2) 它會接收 `TutorialStep` 中的 `高亮目標ID`，並通過一個新的場景輔助系統（見下一條）找到目標UI，然後將 `Highlighter` 移動到目標UI的位置上。

---

### 完整代碼

#### 1. `TutorialSO.cs`
```csharp
using UnityEngine;
using System.Collections.Generic;

[CreateAssetMenu(fileName = "New Tutorial", menuName = "Tutorial/Tutorial Data")]
public class TutorialSO : ScriptableObject
{
    [Header("教學識別")]
    [Tooltip("此教學的唯一ID，用於觸發和完成狀態追蹤。")]
    public string tutorialID;

    [Header("教學步驟序列")]
    [Tooltip("整個教學將按照這個列表的順序進行。")]
    public List<TutorialStep> steps = new List<TutorialStep>();
}
```

#### 2. `TutorialStep.cs`
```csharp
using UnityEngine;

public enum HighlightMode{ None, Icon, Spotlight, Area }
public enum TutorialProgressionMode{ ClickAnywhere, ClickContinueButton, WaitForEvent }

[System.Serializable]
public class TutorialStep
{
    [Header("1. 內容 (Content)")]
    public string title;
    [TextArea(4, 8)]
    public string description;
    public Sprite image;

    [Header("2. 佈局與高亮 (Layout & Highlight)")]
    public GameObject layoutPrefab;
    public HighlightMode highlightMode = HighlightMode.None;
    [Tooltip("將對應此高亮目標的【TutorialTargetID】資產拖曳於此。")]
    public TutorialTargetID highlightTargetIDAsset; 

    [Header("3. 流程控制 (Flow Control)")]
    [Tooltip("完成此步驟並進入下一步的方式")]
    public TutorialProgressionMode progressionMode = TutorialProgressionMode.ClickAnywhere;
    
    [Tooltip("如果推進方式是 WaitForEvent，且不由高亮目標觸發，則填寫此處的 GameEvent ID")]
    public string eventToWaitFor; 
}
```

#### 3. `TutorialDatabase.cs`
```csharp
using UnityEngine;
using System.Collections.Generic;
using System.Linq;

public static class TutorialDatabase
{
    private static Dictionary<string, TutorialSO> tutorials;
    private static bool isLoaded = false;

    private static void LoadDatabase()
    {
        if (isLoaded) return;

        tutorials = new Dictionary<string, TutorialSO>();
        TutorialSO[] loadedTutorials = Resources.LoadAll<TutorialSO>("GameData/Tutorials");

        foreach (var tutorial in loadedTutorials)
        {
            if (!tutorials.ContainsKey(tutorial.tutorialID))
            {
                tutorials.Add(tutorial.tutorialID, tutorial);
            }
            else
            {
                Debug.LogWarning($"[TutorialDatabase] 發現重複的教學 ID: {tutorial.tutorialID}");
            }
        }
        Debug.Log($"[TutorialDatabase] 成功載入 {tutorials.Count} 個教學。");
        isLoaded = true;
    }

    public static TutorialSO GetTutorialByID(string id)
    {
        if (!isLoaded)
        {
            LoadDatabase();
        }

        if (tutorials.TryGetValue(id, out TutorialSO tutorial))
        {
            return tutorial;
        }
        Debug.LogWarning($"[TutorialDatabase] 找不到 ID 為 '{id}' 的教學。");
        return null;
    }
}
```

#### 4. `TutorialTargetID.cs`
```csharp
using UnityEngine;

[CreateAssetMenu(fileName = "TargetID_", menuName = "教學系統/目標ID資產 (Target ID Asset)")]
public class TutorialTargetID : ScriptableObject {/*空腳本。*/}
```

#### 5. `TutorialTarget.cs`
```csharp
using UnityEngine;
using System.Collections.Generic;

public class TutorialTarget : MonoBehaviour
{
    [Header("目標ID資產")]
    [Tooltip("將對應此UI元件的【TutorialTargetID】資產拖曳於此。")]
    public TutorialTargetID targetIDAsset;

    private static Dictionary<TutorialTargetID, RectTransform> targets = new Dictionary<TutorialTargetID, RectTransform>();

    void OnEnable()
    {
        if (targetIDAsset != null)
        {
            if (!targets.ContainsKey(targetIDAsset))
            {
                targets.Add(targetIDAsset, this.transform as RectTransform);
            }
            else
            {
                Debug.LogWarning($"[TutorialTarget] 場景中發現重複的教學目標ID資產: '{targetIDAsset.name}'，位於物件 '{gameObject.name}'。請確保每個ID只被一個活動物件使用。", this);
            }
        }
    }

    void OnDisable()
    {
        if (targetIDAsset != null && targets.ContainsKey(targetIDAsset))
        {
            targets.Remove(targetIDAsset);
        }
    }

    public static RectTransform GetTarget(TutorialTargetID idAsset)
    {
        if (idAsset == null) return null;
        targets.TryGetValue(idAsset, out RectTransform target);
        return target;
    }
}
```

#### 6. `TutorialManager.cs`
```csharp
using UnityEngine;
using System.Collections.Generic;

public class TutorialManager : MonoBehaviour
{
    public static TutorialManager Instance { get; private set; }

    private HashSet<string> completedTutorials = new HashSet<string>();
    private TutorialUI tutorialUI;

    private TutorialSO currentTutorial;
    private int currentStepIndex;
    
    void Awake()
    {
        if (Instance != null && Instance != this) { Destroy(gameObject); return; }
        Instance = this;
        DontDestroyOnLoad(gameObject);
    }
    
    private void OnEnable()
    {
        if (HighlightSystem.Instance != null)
        {
            HighlightSystem.Instance.OnTargetInteracted += HandleTargetInteraction;
        }
        GameEventManager.OnEventTriggered += HandleGameEvent;
    }

    private void OnDisable()
    {
        if (HighlightSystem.Instance != null)
        {
            HighlightSystem.Instance.OnTargetInteracted -= HandleTargetInteraction;
        }
        if (GameEventManager.Instance != null)
        {
            GameEventManager.OnEventTriggered -= HandleGameEvent;
        }
    }
    
    public void RegisterUI(TutorialUI ui)
    {
        tutorialUI = ui;
    }

    public void ShowTutorial(string tutorialID)
    {
        if (completedTutorials.Contains(tutorialID)) 
        {
            Debug.Log($"教學 '{tutorialID}' 已完成，不再顯示。");
            return;
        }
        if (tutorialUI == null) { 
            Debug.LogError("[TutorialManager] TutorialUI 未註冊，無法顯示教學！");
            return;
        }

        currentTutorial = TutorialDatabase.GetTutorialByID(tutorialID);
        if (currentTutorial == null || currentTutorial.steps.Count == 0) return;
        
        currentStepIndex = 0;
        DisplayCurrentStep();
    }

    private void DisplayCurrentStep()
    {
        if (currentTutorial != null && currentStepIndex < currentTutorial.steps.Count)
        {
            TutorialStep step = currentTutorial.steps[currentStepIndex];
            tutorialUI.ShowStep(step);

            if (step.progressionMode == TutorialProgressionMode.WaitForEvent && step.highlightTargetIDAsset != null)
            {
                HighlightSystem.Instance.ShowHighlight(step.highlightTargetIDAsset, step.highlightMode);
            }
            else
            {
                HighlightSystem.Instance.HideAllHighlights();
            }
        }
    }

    public void AdvanceStep()
    {
        currentStepIndex++;
        if (currentStepIndex < currentTutorial.steps.Count)
        {
            DisplayCurrentStep();
        }
        else
        {
            EndTutorial();
        }
    }
    
    private void HandleTargetInteraction(TutorialTargetID interactedID)
    {
        if (currentTutorial == null || currentStepIndex >= currentTutorial.steps.Count) return;

        var currentStep = currentTutorial.steps[currentStepIndex];
        if (currentStep.progressionMode == TutorialProgressionMode.WaitForEvent && currentStep.highlightTargetIDAsset == interactedID)
        {
            AdvanceStep();
        }
    }
    
    private void HandleGameEvent(string eventName)
    {
        if (currentTutorial == null || currentStepIndex >= currentTutorial.steps.Count) return;

        var currentStep = currentTutorial.steps[currentStepIndex];
        if (currentStep.progressionMode == TutorialProgressionMode.WaitForEvent &&
            currentStep.highlightTargetIDAsset != null &&
            eventName == currentStep.highlightTargetIDAsset.name)
        {
            AdvanceStep();
        }
        else if (currentStep.progressionMode == TutorialProgressionMode.WaitForEvent &&
                currentStep.highlightTargetIDAsset == null &&
                !string.IsNullOrEmpty(currentStep.eventToWaitFor) &&
                eventName == currentStep.eventToWaitFor)
        {
            AdvanceStep();
        }
    }

    private void EndTutorial()
    {
        if (currentTutorial == null) return;
        
        HighlightSystem.Instance.HideAllHighlights();
        tutorialUI.Hide();

        MarkAsCompleted(currentTutorial.tutorialID);
        currentTutorial = null;
    }

    private void MarkAsCompleted(string tutorialID)
    {
        if (completedTutorials.Add(tutorialID))
        {
            Debug.Log($"[TutorialManager] 已將教學 '{tutorialID}' 標記為完成。");
        }
    }
    
    public HashSet<string> GetCompletedTutorials() => completedTutorials;
    public void LoadCompletedTutorials(HashSet<string> completed) => completedTutorials = completed ?? new HashSet<string>();
}
```

#### 7. `TutorialTrigger.cs`
```csharp
using UnityEngine;
using System.Collections;

public class TutorialTrigger : MonoBehaviour
{
    [Header("觸發設定")]
    [Tooltip("要觸發的教學的唯一ID。")]
    [SerializeField] private string tutorialID;
    [Tooltip("勾選此項，當玩家進入觸發器範圍時自動觸發。")]
    [SerializeField] private bool triggerOnEnter = true;

    private bool hasTriggered = false;

    private void OnTriggerEnter2D(Collider2D other)
    {
        if (triggerOnEnter && !hasTriggered && this.enabled && other.CompareTag("Player"))
        {
            Trigger();
        }
    }

    public void Trigger()
    {
        if (hasTriggered) return;
        
        hasTriggered = true;
        TutorialManager.Instance.ShowTutorial(tutorialID);
        
        if (triggerOnEnter)
        {
            this.enabled = false;
        }
    }
}
```

#### 8. `TutorialUI.cs`
```csharp
using UnityEngine;
using UnityEngine.UI;

public class TutorialUI : MonoBehaviour
{
    [Header("主面板與交互")]
    [SerializeField] private GameObject tutorialPanel; 
    [SerializeField] private Button fullscreenClickListener;

    private GameObject currentLayoutInstance;
    private TutorialLayoutView currentLayoutView;

    void Awake()
    {
        if (TutorialManager.Instance != null)
        {
            TutorialManager.Instance.RegisterUI(this);
        }
        else
        {
            Debug.LogError("[TutorialUI] 找不到 TutorialManager 實例！教學系統將無法工作。");
        }
        fullscreenClickListener.onClick.AddListener(OnAdvance);
        Hide();
    }
    
    public void ShowStep(TutorialStep step)
    {
        tutorialPanel.SetActive(true);
        // 1. 實例化並獲取佈局視圖
        if (currentLayoutInstance != null) Destroy(currentLayoutInstance);
        if (step.layoutPrefab != null)
        {
            currentLayoutInstance = Instantiate(step.layoutPrefab, tutorialPanel.transform);
            currentLayoutView = currentLayoutInstance.GetComponent<TutorialLayoutView>();
        }
        // 2. 填充內容
        if (currentLayoutView != null)
        {
            currentLayoutView.Populate(step);
        }
        // 3. 綁定流程控制
        fullscreenClickListener.gameObject.SetActive(step.progressionMode == TutorialProgressionMode.ClickAnywhere);
        
        bool showContinueButton = step.progressionMode == TutorialProgressionMode.ClickContinueButton && currentLayoutView?.ContinueButton != null;
        if (currentLayoutView?.ContinueButton != null)
        {
            currentLayoutView.ContinueButton.gameObject.SetActive(showContinueButton);
            if(showContinueButton)
            {
                currentLayoutView.ContinueButton.onClick.RemoveAllListeners();
                currentLayoutView.ContinueButton.onClick.AddListener(OnAdvance);
            }
        }
    }
    
    public void Hide()
    {
        if (tutorialPanel != null) tutorialPanel.SetActive(false);
        if (fullscreenClickListener != null) fullscreenClickListener.gameObject.SetActive(false);
        if (currentLayoutInstance != null) Destroy(currentLayoutInstance);
    }
    
    private void OnAdvance()
    {
        fullscreenClickListener.gameObject.SetActive(false);
        TutorialManager.Instance.AdvanceStep();
    }
}
```

#### 9. `TutorialLayoutView.cs`
```csharp
using UnityEngine;
using UnityEngine.UI;
using TMPro;

public class TutorialLayoutView : MonoBehaviour
{
    [Header("佈局插槽 (可選)")]
    [SerializeField] private TextMeshProUGUI titleText;
    [SerializeField] private TextMeshProUGUI descriptionText;
    [SerializeField] private Image tutorialImage;
    [SerializeField] private Button continueButton;

    public Button ContinueButton => continueButton;

    public void Populate(TutorialStep step)
    {
        if (titleText != null)
        {
            titleText.gameObject.SetActive(!string.IsNullOrEmpty(step.title));
            titleText.text = step.title;
        }
        if (descriptionText != null)
        {
            descriptionText.gameObject.SetActive(!string.IsNullOrEmpty(step.description));
            descriptionText.text = step.description;
        }
        if (tutorialImage != null)
        {
            tutorialImage.gameObject.SetActive(step.image != null);
            tutorialImage.sprite = step.image;
        }
    }
}
```

#### 10. `TutorialDashboardEditor.cs`
```csharp
using UnityEngine;
using UnityEditor;
using System.Collections.Generic;
using System.Linq;

public class TutorialDashboardEditor : EditorWindow
{
    private Vector2 idListScrollPos;
    private Vector2 mainContentScrollPos;
    
    private List<TutorialTargetID> allTargetIDs = new List<TutorialTargetID>();
    private TutorialTargetID selectedTargetID;

    private string searchString = "";

    private List<GameObject> sceneUsages = new List<GameObject>();
    private List<string> tutorialUsages = new List<string>();
    private List<TutorialSO> allTutorialsCache = new List<TutorialSO>();

    [MenuItem("工具 (Tools)/教學系統儀表板")]
    public static void ShowWindow()
    {
        GetWindow<TutorialDashboardEditor>("教學系統儀表板");
    }

    private void OnEnable()
    {
        RefreshData();
    }
    
    private void OnHierarchyChange() => Repaint();
    private void OnProjectChange() => RefreshData();
    private void RefreshData()
    {
        string[] guids = AssetDatabase.FindAssets("t:TutorialTargetID");
        allTargetIDs = guids.Select(g => AssetDatabase.LoadAssetAtPath<TutorialTargetID>(AssetDatabase.GUIDToAssetPath(g)))
                           .OrderBy(id => id.name)
                           .ToList();
        
        string[] tutorialGuids = AssetDatabase.FindAssets("t:TutorialSO");
        allTutorialsCache = tutorialGuids.Select(g => AssetDatabase.LoadAssetAtPath<TutorialSO>(AssetDatabase.GUIDToAssetPath(g))).ToList();
        
        if (selectedTargetID != null)
        {
            UpdateSelectionDetails(selectedTargetID);
        }
        Repaint();
    }
    
    private void OnGUI()
    {
        EditorGUILayout.BeginHorizontal();
        DrawIdListPanel();
        DrawMainContentPanel();
        EditorGUILayout.EndHorizontal();
    }
    
    private void DrawIdListPanel()
    {
        EditorGUILayout.BeginVertical(EditorStyles.helpBox, GUILayout.Width(250), GUILayout.ExpandHeight(true));
        EditorGUILayout.LabelField("目標ID資產列表", EditorStyles.boldLabel);
        if (GUILayout.Button("創建新ID資產"))
        {
            CreateNewTargetIDAsset();
        }
        searchString = EditorGUILayout.TextField("搜索:", searchString);
        idListScrollPos = EditorGUILayout.BeginScrollView(idListScrollPos);
        var filteredIDs = allTargetIDs.Where(id => string.IsNullOrEmpty(searchString) || id.name.ToLower().Contains(searchString.ToLower()));
        
        foreach (var idAsset in filteredIDs)
        {
            if (GUILayout.Button(idAsset.name, selectedTargetID == idAsset ? "flow node 1" : "button"))
            {
                selectedTargetID = idAsset;
                UpdateSelectionDetails(idAsset);
                GUI.FocusControl(null);
            }
        }
        EditorGUILayout.EndScrollView();
        EditorGUILayout.EndVertical();
    }

    private void DrawMainContentPanel()
    {
        EditorGUILayout.BeginVertical(EditorStyles.helpBox, GUILayout.ExpandHeight(true));
        mainContentScrollPos = EditorGUILayout.BeginScrollView(mainContentScrollPos);

        if (selectedTargetID != null)
        {
            DrawSelectionDetails();
        }
        else
        {
            EditorGUILayout.HelpBox("請從左側列表中選擇一個目標ID資產以查看詳細信息。", MessageType.Info);
        }
        EditorGUILayout.Separator();
        DrawValidationTools();
        EditorGUILayout.EndScrollView();
        EditorGUILayout.EndVertical();
    }

    private void DrawSelectionDetails()
    {
        EditorGUILayout.LabelField($"詳細信息: {selectedTargetID.name}", EditorStyles.boldLabel);
        EditorGUILayout.ObjectField("資產文件", selectedTargetID, typeof(TutorialTargetID), false);
        EditorGUILayout.LabelField("當前場景引用", EditorStyles.centeredGreyMiniLabel);
        if (sceneUsages.Any())
        {
            foreach (var usage in sceneUsages)
            {
                if (GUILayout.Button(usage.name))
                {
                    EditorGUIUtility.PingObject(usage);
                    Selection.activeGameObject = usage;
                }
            }
        }
        else
        {
            EditorGUILayout.HelpBox("在當前打開的場景中沒有找到使用此ID的物件。", MessageType.None);
        }

        EditorGUILayout.LabelField("教學步驟引用", EditorStyles.centeredGreyMiniLabel);
        if (tutorialUsages.Any())
        {
            foreach (var usage in tutorialUsages)
            {
                EditorGUILayout.LabelField("- " + usage);
            }
        }
        else
        {
            EditorGUILayout.HelpBox("在任何教學SO中都沒有找到使用此ID的步驟。", MessageType.None);
        }
    }

    private void DrawValidationTools()
    {
        EditorGUILayout.LabelField("全局工具", EditorStyles.boldLabel);

        if (GUILayout.Button("驗證所有教學"))
        {
           ValidateAllTutorials();
        }

        if (GUILayout.Button("查找未使用的ID資產"))
        {
            FindUnusedIDs();
        }
    }

    private void UpdateSelectionDetails(TutorialTargetID idAsset)
    {
        sceneUsages = FindObjectsOfType<TutorialTarget>(true)
            .Where(t => t.targetIDAsset == idAsset)
            .Select(t => t.gameObject)
            .ToList();
            
        tutorialUsages.Clear();
        foreach (var tutorial in allTutorialsCache)
        {
            for (int i = 0; i < tutorial.steps.Count; i++)
            {
                if (tutorial.steps[i].highlightTargetIDAsset == idAsset)
                {
                    tutorialUsages.Add($"{tutorial.name} -> 步驟 {i+1}");
                }
            }
        }
    }
    
    private void CreateNewTargetIDAsset()
    {
        string path = EditorUtility.SaveFilePanelInProject(
            "創建新的目標ID資產",
            "TargetID_New.asset",
            "asset",
            "請輸入新ID資產的文件名");

        if (string.IsNullOrEmpty(path)) return;

        TutorialTargetID newAsset = CreateInstance<TutorialTargetID>();
        AssetDatabase.CreateAsset(newAsset, path);
        AssetDatabase.SaveAssets();
        EditorUtility.FocusProjectWindow();
        Selection.activeObject = newAsset;
        
        RefreshData();
    }

    private void ValidateAllTutorials()
    {
        Debug.Log("--- 開始全局教學系統驗證 ---");
        bool foundIssue = false;

        // 1. 驗證所有教學SO
        foreach (var tutorial in allTutorialsCache)
        {
            for (int i = 0; i < tutorial.steps.Count; i++)
            {
                var step = tutorial.steps[i];
                if (step.highlightMode != HighlightMode.None && step.highlightTargetIDAsset == null)
                {
                    Debug.LogWarning($"【警告】教學 '{tutorial.name}' 的步驟 {i+1} 需要高亮，但 'highlightTargetIDAsset' 為空！", tutorial);
                    foundIssue = true;
                }
            }
        }

        // 2. 驗證場景中的所有TutorialTarget
        var allTargetsInScene = FindObjectsOfType<TutorialTarget>(true);
        foreach (var target in allTargetsInScene)
        {
            if (target.targetIDAsset == null)
            {
                Debug.LogError($"【錯誤】場景物件 '{target.gameObject.name}' 上掛載的 'TutorialTarget' 元件沒有指定 'targetIDAsset'！", target.gameObject);
                foundIssue = true;
            }
        }
        
        if (!foundIssue)
        {
            Debug.Log("--- 驗證完畢，未發現明顯問題。 ---");
        }
    }
    
    private void FindUnusedIDs()
    {
        Debug.Log("--- 開始查找未使用的ID資產 ---");
        bool foundUnused = false;

        HashSet<TutorialTargetID> usedIDs = new HashSet<TutorialTargetID>();

        foreach (var tutorial in allTutorialsCache)
        {
            foreach (var step in tutorial.steps)
            {
                if (step.highlightTargetIDAsset != null)
                {
                    usedIDs.Add(step.highlightTargetIDAsset);
                }
            }
        }

        var allTargetsInScene = FindObjectsOfType<TutorialTarget>(true);
        foreach (var target in allTargetsInScene)
        {
            if (target.targetIDAsset != null)
            {
                usedIDs.Add(target.targetIDAsset);
            }
        }

        foreach (var idAsset in allTargetIDs)
        {
            if (!usedIDs.Contains(idAsset))
            {
                Debug.Log($"【信息】ID資產 '{idAsset.name}' 未在任何教學或當前場景物件中被引用。", idAsset);
                foundUnused = true;
            }
        }

        if (!foundUnused)
        {
            Debug.Log("--- 查找完畢，所有ID資產都至少被引用了一次。 ---");
        }
    }
}
```

#### 11. `TutorialEventListener.cs`
```csharp
using UnityEngine;

public enum TutorialConditionType { InventoryItemAdded }

public class TutorialEventListener : MonoBehaviour
{
    [Header("監聽條件")]
    [SerializeField] private TutorialConditionType conditionType;
    
    [Tooltip("例如：要監聽的物品ID")]
    [SerializeField] private string targetID; 
    
    [Tooltip("觸發條件後，要發送的教學事件ID (對應TutorialTargetID的名稱)")]
    [SerializeField] private string eventNameToTrigger;

    private void OnEnable()
    {
        switch (conditionType)
        {
            case TutorialConditionType.InventoryItemAdded:
                InventoryManager.Instance.OnInventoryChanged += CheckInventoryCondition;
                break;
        }
    }

    private void OnDisable()
    {
        if (InventoryManager.Instance != null)
        {
            InventoryManager.Instance.OnInventoryChanged -= CheckInventoryCondition;
        }
    }
    
    private void CheckInventoryCondition()
    {
        Item itemToCheck = ItemDatabase.Instance.GetItemByID(targetID);
        if (itemToCheck == null) return;
        
        if (InventoryManager.Instance.HasItem(itemToCheck))
        {
            Debug.Log($"[TutorialEventListener] 偵測到玩家背包中增加了 '{itemToCheck.itemName}'，觸發教學事件: {eventNameToTrigger}");
            
            GameEventManager.Instance.TriggerEvent(eventNameToTrigger);
            
            gameObject.SetActive(false); 
        }
    }
}
```

#### 12. `HighlightableObjec.c`
```csharp
using UnityEngine;
using UnityEngine.EventSystems;
using System;

public class HighlightableObject : MonoBehaviour, IPointerClickHandler
{
    [Header("目標ID資產")]
    [Tooltip("將對應此UI元件的【TutorialTargetID】資產拖曳於此。")]
    public TutorialTargetID targetIDAsset;

    public static event Action<TutorialTargetID> OnObjectInteracted;

    public void OnPointerClick(PointerEventData eventData)
    {
        if (targetIDAsset != null)
        {
            Debug.Log($"[HighlightableObject] '{targetIDAsset.name}' 被點擊，正在廣播事件。");
            OnObjectInteracted?.Invoke(targetIDAsset);
        }
    }
}
```

#### 13. `HighlightSystem.cs`
```csharp
using UnityEngine;
using System;
using System.Collections.Generic;

public class HighlightSystem : MonoBehaviour
{
    public static HighlightSystem Instance { get; private set; }

    [Header("高亮特效物件")]
    [Tooltip("將 Canvas 下用於高亮的根物件拖到這裡，例如 'Highlighters'")]
    [SerializeField] private GameObject highlightersParent;
    [SerializeField] private GameObject highlighterIcon;
    [SerializeField] private GameObject highlighterSpotlight;
    [SerializeField] private RectTransform spotlightHole; 
    [SerializeField] private GameObject highlighterArea;
    
    public event Action<TutorialTargetID> OnTargetInteracted;

    void Awake()
    {
        if (Instance != null && Instance != this)
        {
            Destroy(gameObject);
            return;
        }
        Instance = this;
        DontDestroyOnLoad(gameObject);
        HideAllHighlights();
    }

    private void OnEnable()
    {
        HighlightableObject.OnObjectInteracted += HandleObjectInteraction;
    }

    private void OnDisable()
    {
        HighlightableObject.OnObjectInteracted -= HandleObjectInteraction;
    }

    public void ShowHighlight(TutorialTargetID targetID, HighlightMode mode)
    {
        HideAllHighlights();
        if (targetID == null || mode == HighlightMode.None) return;

        RectTransform targetRect = TutorialTarget.GetTarget(targetID);
        if (targetRect == null)
        {
            Debug.LogWarning($"[HighlightSystem] 想要高亮 '{targetID.name}'，但在場景中找不到對應的 TutorialTarget。");
            return;
        }

        if (highlightersParent != null) highlightersParent.SetActive(true);

        switch (mode)
        {
            case HighlightMode.Icon:
                if (highlighterIcon)
                {
                    highlighterIcon.SetActive(true);
                    highlighterIcon.transform.position = targetRect.position; 
                }
                break;
            case HighlightMode.Spotlight:
                if (highlighterSpotlight && spotlightHole)
                {
                    highlighterSpotlight.SetActive(true);
                    spotlightHole.position = targetRect.position;
                    spotlightHole.sizeDelta = targetRect.rect.size;
                }
                break;
            case HighlightMode.Area:
                if (highlighterArea)
                {
                    highlighterArea.SetActive(true);
                    highlighterArea.transform.position = targetRect.position;
                    (highlighterArea.transform as RectTransform).sizeDelta = targetRect.rect.size;
                }
                break;
        }
    }

    public void HideAllHighlights()
    {
        if (highlightersParent != null)
        {
            highlightersParent.SetActive(false);
        }
        else
        {
            if (highlighterIcon) highlighterIcon.SetActive(false);
            if (highlighterSpotlight) highlighterSpotlight.SetActive(false);
            if (highlighterArea) highlighterArea.SetActive(false);
        }
    }

    private void HandleObjectInteraction(TutorialTargetID interactedID)
    {
        OnTargetInteracted?.Invoke(interactedID);
    }
}
```